<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bolão do Brasileirão - Compras 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React e Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: black;
            color: #e4e4e7;
            transition: background-color 0.3s ease;
        }
        .glass {
            background: rgba(24, 24, 27, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .animate-pulse-slow {
            animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
          "imports": {
            "firebase/app": "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"
          }
        }
    </script>

    <script type="text/babel" data-type="module">
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, onSnapshot, updateDoc, deleteDoc, addDoc } from 'firebase/firestore';

        const { useState, useEffect, useMemo, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyA1R9T2koetMW6Gogo7NAzt8FVkfpdMpsU",
            authDomain: "bolaocomprasbrasileirao.firebaseapp.com",
            projectId: "bolaocomprasbrasileirao",
            storageBucket: "bolaocomprasbrasileirao.firebasestorage.app",
            messagingSenderId: "575686491581",
            appId: "1:575686491581:web:399d2ab692ee17a0bba6d4",
            measurementId: "G-F62PQLJC9Y"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appIdFirestore = 'bolaocomprasbrasileirao-prod';
        const ADMIN_PASSWORD = "1234";

        // --- COMPONENTES GLOBAIS ---

        const LucideIcon = ({ name, size = 24, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    window.lucide.createIcons({ root: containerRef.current });
                }
            }, [name]);
            return <span ref={containerRef} className={`inline-flex items-center justify-center ${className}`} dangerouslySetInnerHTML={{ __html: `<i data-lucide="${name}" style="width: ${size}px; height: ${size}px;"></i>` }} />;
        };

        const Header = ({ setView, view, selectedPlayer, players, setSelectedPlayer }) => (
            <header className="sticky top-0 z-50 p-4 bg-zinc-900/90 backdrop-blur-md border-b border-white/5">
                <div className="max-w-5xl mx-auto flex justify-between items-center mb-4">
                    <div className="flex items-center gap-2">
                        <div className="p-2 bg-emerald-500 rounded-lg shadow-[0_0_15px_rgba(16,185,129,0.3)]"><LucideIcon name="trophy" className="text-black" size={20} /></div>
                        <h1 className="text-lg font-black uppercase italic tracking-tighter">Bolão <span className="text-emerald-500">2026</span></h1>
                    </div>
                    <button onClick={() => setView('admin')} className={`p-2 rounded-lg transition-all ${view === 'admin' ? 'bg-emerald-500 text-black' : 'bg-zinc-800 text-zinc-400'}`}>
                        <LucideIcon name="settings" size={20} />
                    </button>
                </div>
                {view !== 'admin' && (
                    <div className="max-w-5xl mx-auto flex items-center gap-3 px-2">
                        <div className="w-12 h-12 rounded-full border-2 border-emerald-500/20 overflow-hidden bg-zinc-800 shadow-xl">
                            {selectedPlayer?.avatar ? <img src={selectedPlayer.avatar} className="w-full h-full object-cover" /> : <LucideIcon name="user" className="m-auto mt-3 opacity-20" size={24} />}
                        </div>
                        <select 
                            value={selectedPlayer?.id || ""} 
                            onChange={(e) => setSelectedPlayer(players.find(x => x.id === e.target.value))}
                            className="flex-1 bg-zinc-900 border border-white/10 rounded-2xl p-4 text-sm font-black outline-none focus:border-emerald-500 shadow-inner appearance-none"
                        >
                            <option value="">ENTRAR NO PERFIL...</option>
                            {players.sort((a,b)=>a.name.localeCompare(b.name)).map(p => <option key={p.id} value={p.id}>{String(p.name).toUpperCase()}</option>)}
                        </select>
                    </div>
                )}
            </header>
        );

        const Navigation = ({ setView, view }) => (
            <nav className="fixed bottom-0 left-0 right-0 bg-black/95 backdrop-blur-2xl border-t border-white/5 p-4 z-50 flex justify-around items-center max-w-5xl mx-auto md:rounded-t-[40px] shadow-2xl">
                {[
                    { id: 'palpites', icon: 'zap', label: 'Arena' },
                    { id: 'classicos', icon: 'shield', label: 'Clássicos' },
                    { id: 'bonus', icon: 'target', label: 'Quem é Quem' },
                    { id: 'ranking', icon: 'bar-chart-3', label: 'Ranking' }
                ].map(item => (
                    <button key={item.id} onClick={() => setView(item.id)} className={`flex flex-col items-center transition-all ${view === item.id ? 'text-emerald-400 scale-110' : 'text-zinc-600'}`}>
                        <LucideIcon name={item.icon} size={24} className={view === item.id ? 'drop-shadow-[0_0_8px_rgba(52,211,153,0.8)]' : ''} />
                        <span className="text-[9px] font-black mt-1 uppercase tracking-widest">{item.label}</span>
                    </button>
                ))}
            </nav>
        );

        const MatchCard = ({ match, predictions, teams, selectedPlayer, config, db, showRoundBadge = false }) => {
            const handleSave = async (matchId, h, a) => {
                if (!selectedPlayer) return;
                const predId = `${selectedPlayer.id}_${matchId}`;
                await setDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'predictions', predId), { playerId: selectedPlayer.id, matchId, homeScore: h, awayScore: a });
            };
            const pred = predictions.find(p => p.playerId === selectedPlayer?.id && p.matchId === match.id);
            const hT = teams.find(t => t.id === match.homeId);
            const aT = teams.find(t => t.id === match.awayId);

            return (
                <div key={match.id} className="glass rounded-[32px] p-8 relative overflow-hidden transition-all hover:scale-[1.01] border-l-4 border-emerald-500/30">
                    {showRoundBadge && (
                        <div className="absolute top-3 right-5 text-[8px] font-black uppercase text-amber-500 italic tracking-[0.2em]">
                            {match.isCustom ? "Confronto Especial" : `Rodada ${match.round}`}
                        </div>
                    )}
                    <div className="flex items-center justify-between gap-4">
                        <div className="flex-1 flex flex-col items-center text-center">
                            <div className="w-20 h-20 bg-black rounded-3xl mb-3 flex items-center justify-center p-3 border border-white/5 shadow-2xl">
                                {hT?.logo ? <img src={hT.logo} className="w-full h-full object-contain" /> : <LucideIcon name="shield" className="opacity-10" size={32} />}
                            </div>
                            <span className="text-[10px] font-black uppercase leading-tight tracking-tighter">{hT?.name}</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <input type="number" disabled={config.rodada_fechada || !selectedPlayer} value={pred?.homeScore ?? ""} onChange={e => handleSave(match.id, e.target.value, pred?.awayScore || "")} className="w-14 h-20 bg-black border border-white/10 rounded-2xl text-center font-black text-3xl text-emerald-400 focus:border-emerald-500 outline-none shadow-inner" />
                            <span className="text-zinc-800 italic font-black text-xs">X</span>
                            <input type="number" disabled={config.rodada_fechada || !selectedPlayer} value={pred?.awayScore ?? ""} onChange={e => handleSave(match.id, pred?.homeScore || "", e.target.value)} className="w-14 h-20 bg-black border border-white/10 rounded-2xl text-center font-black text-3xl text-emerald-400 focus:border-emerald-500 outline-none shadow-inner" />
                        </div>
                        <div className="flex-1 flex flex-col items-center text-center">
                            <div className="w-20 h-20 bg-black rounded-3xl mb-3 flex items-center justify-center p-3 border border-white/5 shadow-2xl">
                                {aT?.logo ? <img src={aT.logo} className="w-full h-full object-contain" /> : <LucideIcon name="shield" className="opacity-10" size={32} />}
                            </div>
                            <span className="text-[10px] font-black uppercase leading-tight tracking-tighter">{aT?.name}</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- VIEWS ---

        const PalpitesView = ({ currentRound, setCurrentRound, matches, predictions, teams, selectedPlayer, config, db }) => {
            const filtered = matches.filter(m => Number(m.round) === Number(currentRound));
            return (
                <div className="p-4 pb-32 max-w-3xl mx-auto space-y-6 animate-in fade-in">
                    <div className="flex justify-between items-center bg-zinc-900/50 p-5 rounded-3xl border border-white/5 shadow-xl">
                        <div className="flex items-center gap-2">
                            <LucideIcon name="calendar" className="text-emerald-500" size={18} />
                            <span className="font-black uppercase italic text-zinc-400">Rodada</span>
                        </div>
                        <select value={currentRound} onChange={e => setCurrentRound(Number(e.target.value))} className="bg-black border border-white/10 rounded-xl px-4 py-2 text-emerald-500 font-black outline-none">
                            {[...Array(38)].map((_, i) => <option key={i+1} value={i+1}>Rodada {i+1}</option>)}
                        </select>
                    </div>
                    <div className="space-y-6">
                        {filtered.length > 0 ? filtered.map(match => (
                            <MatchCard key={match.id} match={match} predictions={predictions} teams={teams} selectedPlayer={selectedPlayer} config={config} db={db} />
                        )) : <div className="p-20 text-center uppercase font-black text-zinc-800 tracking-widest italic animate-pulse">Sincronizando confrontos...</div>}
                    </div>
                </div>
            );
        };

        const ClassicosView = ({ matches, predictions, teams, selectedPlayer, config, db }) => {
            const classicosTeams = ['pal', 'cor', 'san', 'spa'];
            const filtered = useMemo(() => {
                return matches.filter(m => (classicosTeams.includes(m.homeId) && classicosTeams.includes(m.awayId)) || m.isCustom)
                              .sort((a,b) => (a.isCustom ? -1 : 1) || (a.round - b.round));
            }, [matches]);

            return (
                <div className="p-4 pb-32 max-w-3xl mx-auto space-y-6 animate-in fade-in">
                    <div className="text-center mb-10">
                        <h2 className="text-2xl font-black uppercase italic text-white tracking-tighter">Arena dos <span className="text-emerald-500">Clássicos</span></h2>
                    </div>
                    <div className="space-y-6">
                        {filtered.map(match => (
                            <MatchCard key={match.id} match={match} predictions={predictions} teams={teams} selectedPlayer={selectedPlayer} config={config} db={db} showRoundBadge={true} />
                        ))}
                    </div>
                </div>
            );
        };

        const RankingView = ({ players }) => (
            <div className="p-4 pb-32 max-w-3xl mx-auto space-y-6 animate-in fade-in">
                <h2 className="text-2xl font-black uppercase italic text-center text-white tracking-tighter">Ranking <span className="text-emerald-500">Geral</span></h2>
                <div className="glass rounded-[40px] overflow-hidden shadow-2xl border border-white/5">
                    <table className="w-full text-left">
                        <thead className="bg-white/5 border-b border-white/5 text-[9px] uppercase font-black text-emerald-500/50">
                            <tr><th className="p-6">#</th><th className="p-6">Bio-ID</th><th className="p-6 text-right">Total</th></tr>
                        </thead>
                        <tbody className="divide-y divide-white/5">
                            {players.sort((a,b)=> (b.totalPoints || 0) - (a.totalPoints || 0)).map((p, idx) => (
                                <tr key={p.id} className="hover:bg-white/5 transition-colors group">
                                    <td className="p-6 font-black italic text-zinc-700">{idx + 1}</td>
                                    <td className="p-6 flex items-center gap-4">
                                        <div className="w-12 h-12 rounded-full bg-zinc-900 border-2 border-white/5 overflow-hidden">
                                            {p.avatar && <img src={p.avatar} className="w-full h-full object-cover" />}
                                        </div>
                                        <span className="font-black uppercase text-sm">{p.name}</span>
                                    </td>
                                    <td className="p-6 text-right font-black text-emerald-500 text-xl">{p.totalPoints || 0}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const AdminView = ({ adminAuth, setAdminAuth, adminPassInput, setAdminPassInput, adminTab, setAdminTab, db, players, teams, matches, predictions, currentRound, setCurrentRound, config, setView, populateOfficialCalendar }) => {
            const [newPlayerName, setNewPlayerName] = useState("");
            const [deletedPlayers, setDeletedPlayers] = useState([]);
            const [customMatch, setCustomMatch] = useState({ homeId: "", awayId: "" });

            useEffect(() => {
                if (adminAuth) {
                    onSnapshot(collection(db, 'artifacts', appIdFirestore, 'public', 'data', 'deleted_players'), (snap) => {
                        setDeletedPlayers(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                    });
                }
            }, [adminAuth]);

            const restorePlayer = async (player) => {
                if (!confirm(`Restaurar perfil de ${player.name}?`)) return;
                const { id, ...data } = player;
                await setDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'players', id), data);
                await deleteDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'deleted_players', id));
            };

            const adjustPoints = async (playerId, currentPoints, amount) => {
                const newPoints = (currentPoints || 0) + amount;
                await updateDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'players', playerId), { 
                    bonusPoints: newPoints 
                });
            };

            const safeDelete = async (player) => {
                if (!confirm(`Mover ${player.name} para a lixeira?`)) return;
                await setDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'deleted_players', player.id), player);
                await deleteDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'players', player.id));
            };

            const processPoints = async () => {
                if (!confirm("Recalcular ranking?")) return;
                for (const player of players) {
                    let totalP = 0;
                    matches.forEach(m => {
                        if (m.homeScore !== undefined && m.homeScore !== "") {
                            const pred = predictions.find(pr => pr.playerId === player.id && pr.matchId === m.id);
                            if (pred && pred.homeScore !== "" && pred.awayScore !== "") {
                                const rH = parseInt(m.homeScore); const rA = parseInt(m.awayScore);
                                const pH = parseInt(pred.homeScore); const pA = parseInt(pred.awayScore);
                                const act = rH > rA ? 'H' : rH < rA ? 'A' : 'D';
                                const prd = pH > pA ? 'H' : pH < pA ? 'A' : 'D';
                                if (rH === pH && rA === pA) totalP += 5;
                                else if (act === prd) totalP += 3;
                                else totalP -= 1;
                            }
                        }
                    });
                    await updateDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'players', player.id), { totalPoints: totalP + (player.bonusPoints || 0) });
                }
                alert("Rankings sincronizados!");
            };

            const handleFileUpload = (e, id, type) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const base64 = reader.result;
                    await updateDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', type === 'players' ? 'players' : 'teams', id), { [type === 'players' ? 'avatar' : 'logo']: base64 });
                    alert("Imagem atualizada!");
                };
                reader.readAsDataURL(file);
            };

            if (!adminAuth) return (
                <div className="p-12 h-[calc(100vh-100px)] flex items-center justify-center">
                    <div className="glass p-12 rounded-[48px] w-full max-w-sm text-center shadow-2xl relative border-emerald-500/20">
                        <div className="absolute top-2 right-2 p-4"><button onClick={() => setView('palpites')} className="text-zinc-600 hover:text-red-500"><LucideIcon name="x-circle" size={24} /></button></div>
                        <LucideIcon name="lock" size={64} className="text-emerald-500 mx-auto mb-8 drop-shadow-[0_0_15px_rgba(16,185,129,0.4)]" />
                        <h2 className="text-2xl font-black uppercase italic mb-10 tracking-tighter">Portal <span className="text-emerald-500">Master</span></h2>
                        <input type="password" placeholder="SENHA ADMIN" className="w-full bg-black border border-white/10 p-6 rounded-3xl mb-8 text-center font-black text-white focus:border-emerald-500 outline-none" value={adminPassInput} onChange={e => setAdminPassInput(e.target.value)} />
                        <button onClick={() => adminPassInput === ADMIN_PASSWORD ? setAdminAuth(true) : alert("Código Inválido")} className="w-full bg-emerald-500 text-black py-6 rounded-3xl font-black uppercase shadow-xl hover:scale-[1.02] active:scale-95 transition-all">Desbloquear</button>
                    </div>
                </div>
            );

            return (
                <div className="p-6 pb-32 max-w-4xl mx-auto space-y-10 animate-in fade-in">
                    <div className="flex justify-between items-center bg-zinc-900 border border-white/5 p-6 rounded-[32px] shadow-2xl">
                        <h2 className="text-xl font-black uppercase italic tracking-widest text-zinc-500">Terminal <span className="text-emerald-500">Admin</span></h2>
                        <button onClick={() => setAdminAuth(false)} className="bg-red-500 text-white px-8 py-3 rounded-2xl font-black text-xs uppercase shadow-xl">Sair</button>
                    </div>

                    <div className="flex bg-zinc-900 border border-white/10 p-1.5 rounded-3xl gap-2">
                        {['jogadores', 'resultados', 'rodadas', 'clubes'].map(t => (
                            <button key={t} onClick={() => setAdminTab(t)} className={`flex-1 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all ${adminTab === t ? 'bg-emerald-500 text-black shadow-lg' : 'text-zinc-500'}`}>{t}</button>
                        ))}
                    </div>

                    {adminTab === 'jogadores' && (
                        <div className="space-y-10">
                            {/* LIXEIRA DESTAQUE */}
                            {deletedPlayers.length > 0 && (
                                <div className="bg-orange-500/10 border-2 border-orange-500/40 p-8 rounded-[48px] animate-in slide-in-from-top-6">
                                    <h3 className="text-orange-500 font-black uppercase italic text-2xl mb-6 flex items-center gap-3"><LucideIcon name="trash-2"/> Lixeira de Bio-IDs</h3>
                                    <div className="space-y-4">
                                        {deletedPlayers.map(p => (
                                            <div key={p.id} className="bg-black/60 border border-orange-500/20 p-6 rounded-3xl flex justify-between items-center">
                                                <span className="font-black text-white uppercase italic text-xl">{p.name}</span>
                                                <button onClick={() => restorePlayer(p)} className="bg-orange-500 text-black px-8 py-4 rounded-2xl font-black uppercase text-xs hover:bg-orange-400">Restaurar Perfil</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* GESTÃO DE JOGADORES E PONTOS */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {players.sort((a,b)=>a.name.localeCompare(b.name)).map(p => (
                                    <div key={p.id} className="glass p-8 rounded-[32px] flex flex-col gap-6 group hover:border-emerald-500/30 transition-all shadow-xl">
                                        <div className="flex justify-between items-center">
                                            <div className="flex items-center gap-4">
                                                <div className="w-14 h-14 rounded-2xl border-2 border-white/10 overflow-hidden shadow-2xl">
                                                    {p.avatar ? <img src={p.avatar} className="w-full h-full object-cover" /> : <LucideIcon name="user" className="m-auto mt-3 opacity-10" size={28}/>}
                                                </div>
                                                <span className="font-black uppercase italic text-sm text-white">{p.name}</span>
                                            </div>
                                            <button onClick={() => safeDelete(p)} className="text-red-500/30 hover:text-red-500 p-3 hover:bg-red-500/10 rounded-2xl transition-all"><LucideIcon name="trash-2" size={20} /></button>
                                        </div>
                                        
                                        {/* GESTÃO DE PONTOS MANUAL */}
                                        <div className="bg-black/40 p-5 rounded-2xl border border-white/5 space-y-4">
                                            <span className="text-[10px] font-black uppercase text-emerald-500/50 tracking-widest italic">Ajuste Manual de Pontos</span>
                                            <div className="flex items-center justify-between">
                                                <button onClick={() => adjustPoints(p.id, p.bonusPoints, -1)} className="w-12 h-12 bg-red-500/10 text-red-500 rounded-xl border border-red-500/20 font-black text-2xl hover:bg-red-500 hover:text-white transition-all">-</button>
                                                <div className="flex flex-col items-center">
                                                    <span className="text-2xl font-black text-emerald-500">{p.bonusPoints || 0}</span>
                                                    <span className="text-[8px] uppercase font-black text-zinc-600">Pontos Bónus</span>
                                                </div>
                                                <button onClick={() => adjustPoints(p.id, p.bonusPoints, 1)} className="w-12 h-12 bg-emerald-500/10 text-emerald-500 rounded-xl border border-emerald-500/20 font-black text-2xl hover:bg-emerald-500 hover:text-white transition-all">+</button>
                                            </div>
                                            <button onClick={() => adjustPoints(p.id, p.bonusPoints, 5)} className="w-full py-2 bg-emerald-500/5 border border-emerald-500/10 rounded-lg text-[9px] font-black uppercase hover:bg-emerald-500/10">+5 Pontos Rápidos</button>
                                        </div>

                                        <div className="pt-4 border-t border-white/5">
                                            <input type="file" accept="image/*" onChange={(e) => handleFileUpload(e, p.id, 'players')} className="block w-full text-[10px] text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-emerald-500 file:text-black font-black" />
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            <div className="glass p-8 rounded-[40px] border-emerald-500/10">
                                <div className="flex gap-4">
                                    <input type="text" placeholder="NOVO BIO-ID" className="flex-1 bg-black border border-white/10 rounded-2xl px-8 font-black text-white outline-none focus:border-emerald-500" value={newPlayerName} onChange={e => setNewPlayerName(e.target.value)} />
                                    <button onClick={async () => { if(!newPlayerName.trim()) return; await addDoc(collection(db, 'artifacts', appIdFirestore, 'public', 'data', 'players'), { name: newPlayerName.trim(), totalPoints: 0, bonusPoints: 0, avatar: "" }); setNewPlayerName(""); }} className="bg-emerald-500 text-black px-10 rounded-2xl font-black uppercase text-xs active:scale-95">Registrar</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {adminTab === 'resultados' && (
                        <div className="space-y-8">
                            <button onClick={processPoints} className="w-full bg-emerald-600 text-black py-6 rounded-[32px] font-black uppercase italic shadow-2xl hover:brightness-110 active:scale-95 transition-all flex items-center justify-center gap-3">
                                <LucideIcon name="zap" size={24}/> Recalcular Rede de Ranking
                            </button>
                            <select value={currentRound} onChange={e => setCurrentRound(Number(e.target.value))} className="w-full p-6 rounded-[32px] bg-zinc-900 border border-white/10 text-emerald-500 font-black uppercase shadow-inner outline-none">
                                {[...Array(38)].map((_, i) => <option key={i+1} value={i+1}>Rodada {i+1}</option>)}
                                <option value="99">Clássicos Avulsos / Especiais</option>
                            </select>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {matches.filter(m => Number(m.round) === Number(currentRound)).map(m => (
                                    <div key={m.id} className="glass p-6 rounded-[32px] flex items-center gap-4 border-l-4 border-emerald-500/50 shadow-xl">
                                        <span className="text-[10px] font-black uppercase truncate flex-1 text-right text-zinc-400">{teams.find(t=>t.id===m.homeId)?.name}</span>
                                        <div className="flex gap-2">
                                            <input type="number" defaultValue={m.homeScore} onBlur={e => updateDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'matches', m.id), {homeScore: e.target.value})} className="w-10 bg-black border border-white/10 text-center rounded-xl text-emerald-400 font-black text-lg py-2" />
                                            <input type="number" defaultValue={m.awayScore} onBlur={e => updateDoc(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'matches', m.id), {awayScore: e.target.value})} className="w-10 bg-black border border-white/10 text-center rounded-xl text-emerald-400 font-black text-lg py-2" />
                                        </div>
                                        <span className="text-[10px] font-black uppercase truncate flex-1 text-zinc-400">{teams.find(t=>t.id===m.awayId)?.name}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    {/* ... Abas de Rodadas e Clubes simplificadas para manter o código leve ... */}
                </div>
            );
        };

        // --- APP CORE ---

        function App() {
            const [view, setView] = useState('palpites');
            const [currentRound, setCurrentRound] = useState(3);
            const [adminAuth, setAdminAuth] = useState(false);
            const [adminPassInput, setAdminPassInput] = useState("");
            const [adminTab, setAdminTab] = useState('jogadores');
            const [players, setPlayers] = useState([]);
            const [teams, setTeams] = useState([]);
            const [matches, setMatches] = useState([]);
            const [predictions, setPredictions] = useState([]);
            const [config, setConfig] = useState({ rodada_fechada: false });
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const init = async () => { try { await signInAnonymously(auth); } catch(e){} };
                init();
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        onSnapshot(doc(db, 'artifacts', appIdFirestore, 'public', 'data', 'config', 'settings'), (snap) => snap.exists() && setConfig(snap.data()));
                        onSnapshot(collection(db, 'artifacts', appIdFirestore, 'public', 'data', 'players'), (snap) => {
                            const list = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                            setPlayers(list);
                            if (selectedPlayer) setSelectedPlayer(list.find(p => p.id === selectedPlayer.id));
                        });
                        onSnapshot(collection(db, 'artifacts', appIdFirestore, 'public', 'data', 'teams'), (snap) => setTeams(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                        onSnapshot(collection(db, 'artifacts', appIdFirestore, 'public', 'data', 'matches'), (snap) => { setMatches(snap.docs.map(d => ({ id: d.id, ...d.data() }))); setLoading(false); });
                        onSnapshot(collection(db, 'artifacts', appIdFirestore, 'public', 'data', 'predictions'), (snap) => setPredictions(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                    }
                });
            }, []);

            if (loading) return <div className="h-screen bg-black flex flex-col items-center justify-center"><div className="w-16 h-16 border-[4px] border-emerald-500/10 border-t-emerald-500 rounded-full animate-spin mb-4" /><p className="text-emerald-500 font-black tracking-widest text-[10px] animate-pulse uppercase">BIO-NÚCLEO ONLINE...</p></div>;

            return (
                <div className="min-h-screen pb-40">
                    <Header setView={setView} view={view} selectedPlayer={selectedPlayer} players={players} setSelectedPlayer={setSelectedPlayer} />
                    <main className="relative z-10">
                        {view === 'palpites' && <PalpitesView currentRound={currentRound} setCurrentRound={setCurrentRound} matches={matches} predictions={predictions} teams={teams} selectedPlayer={selectedPlayer} config={config} db={db} />}
                        {view === 'classicos' && <ClassicosView matches={matches} predictions={predictions} teams={teams} selectedPlayer={selectedPlayer} config={config} db={db} />}
                        {view === 'ranking' && <RankingView players={players} />}
                        {view === 'bonus' && <BonusView />}
                        {view === 'admin' && <AdminView adminAuth={adminAuth} setAdminAuth={setAdminAuth} adminPassInput={adminPassInput} setAdminPassInput={setAdminPassInput} adminTab={adminTab} setAdminTab={setAdminTab} db={db} players={players} teams={teams} matches={matches} predictions={predictions} currentRound={currentRound} setCurrentRound={setCurrentRound} config={config} setView={setView} />}
                    </main>
                    <Navigation setView={setView} view={view} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
